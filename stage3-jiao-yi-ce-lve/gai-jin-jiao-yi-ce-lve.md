---
description: >-
  上节课的代码仍有很多不完善的地方：例如会每隔3s都要计算一次ma10、买入时没有判断当前账户资金余量、卖出时没有判断是否有能够卖出的单子等等......所以这节课需要把一些细节完善。
---

# 改进交易策略

## 需要改进的地方

### 减少ma10计算次数

通过定义实例属性（True/False）来设置和判断当前是否是一个newBar。

### 买入/卖出逻辑

1. 需要设置一个资金池（定义一个实例属性），代表当前账户余额。
2. 设置一个实例属性self.current\_orders，类型为字典，存放当前购买的股票信息。
3. 设置一个实例属性self.history\_orders，类型为字典，存放卖出的股票信息（注意卖出时，是把当前order从current\_orders删除，再添加到history\_orders）。
4. 如果达到了买入条件（即低于ma10一定价格），那么先判断账户里资金是否足够买100手，如果够，则买入，否则退出（return）。
5. 如果达到了卖出条件（即高于ma10一定价格），那么判断账户里是否有已购买的，如果有，则一次性全部卖出，否则退出（return)。
6. 买入卖出时，别忘了对账户余额进行加减。
